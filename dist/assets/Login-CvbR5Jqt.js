import{b as v,c as y,r as o,i as w,j as s,L as b}from"./index-Kw8xKDi7.js";const m="/api";function P(){const[N,p]=v("auth_token",""),h=y(),[l,u]=o.useState([]),n=o.useRef([]),[g,r]=o.useState({}),[d,c]=w();o.useEffect(()=>{var t;return(t=n.current[0])==null||t.focus(),()=>{r({}),u([])}},[]),o.useEffect(()=>{d.get("code")},[d]);const f=(t,a)=>{var i;const e=t.target.value.replace(/\D/,"");t.target.value=e,e&&a<5&&((i=n.current[a+1])==null||i.focus())},j=(t,a)=>{var e;t.key==="Backspace"&&!t.target.value&&a>0&&((e=n.current[a-1])==null||e.focus())},x=async t=>{if(r({}),l.length==0)c({code:String(0)});else{t.preventDefault();const a=n.current.map(e=>e.value).join("");try{const e=await fetch(m+"/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l[0].email,password:l[0].password,vcode:a})}),i=await e.json();e.ok&&(p(i.token),h("/admin"))}catch(e){console.log(e),c({code:String(0)})}}},S=async t=>{t.preventDefault(),r({});try{const e=await(await fetch(m+"/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.target.email.value,password:t.target.password.value})})).json();r({code:String(e.code)||0,message:String(e.message)||"",status:String(e.status)||200}),e.code&&(c({code:String(e.code)}),u([{email:t.target.email.value,password:t.target.password.value}]))}catch(a){console.log(a),c({code:String(0)}),r({code:String(data.code)||0,message:String(data.message)||"",status:String(data.status)||200})}};return d.get("code")==1?s.jsxs("div",{className:"sms-container",children:[s.jsx("h2",{children:"Подтверждение"}),s.jsx("p",{children:"Введите 6-значный код, отправленный вам в SMS"}),s.jsxs("form",{onSubmit:x,children:[s.jsx("div",{className:"code-inputs",children:Array.from({length:6}).map((t,a)=>s.jsx("input",{type:"text",maxLength:"1",inputMode:"numeric",pattern:"\\d*",ref:e=>n.current[a]=e,onChange:e=>f(e,a),onKeyDown:e=>j(e,a),required:!0},a))}),s.jsx("button",{className:"btn",type:"submit",children:"Подтвердить"})]}),s.jsx("div",{className:"resend",children:s.jsx(b,{to:"/login",children:"Назад"})})]}):s.jsxs("div",{className:"login-container",children:[s.jsx("h2",{children:"Добро пожаловать!"}),s.jsxs("form",{onSubmit:t=>S(t),children:[s.jsxs("div",{className:"input-group",children:[s.jsx("label",{htmlFor:"email",children:"Электронная почта"}),s.jsx("input",{type:"email",id:"email",placeholder:"example@mail.com",name:"email",onInput:()=>r({}),required:!0})]}),s.jsxs("div",{className:"input-group",children:[s.jsx("label",{htmlFor:"password",children:"Пароль"}),s.jsx("input",{type:"password",id:"password",name:"password",placeholder:"Ваш пароль",onInput:()=>r({}),required:!0})]}),s.jsx("p",{className:"error_rez",children:g.message}),s.jsx("button",{className:"btn",type:"submit",children:"Войти"})]}),s.jsx("div",{className:"footer-text"})]})}export{P as default};
